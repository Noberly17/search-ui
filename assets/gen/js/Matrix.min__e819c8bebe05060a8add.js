webpackJsonpCoveo__temporary([16],{145:function(e,t,o){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(22),r=o(89),s=o(5),l=o(0),u=function(e){function t(t){var o=e.call(this)||this;return o.templates=t,s.Assert.exists(t),o}return i(t,e),t.prototype.instantiateToString=function(e,t){void 0===t&&(t={});for(var o=(new n.DefaultInstantiateTemplateOptions).merge(t),i=l.reject(this.templates,function(e){return null!=e.role}),r=0;r<i.length;r++){var s=i[r].instantiateToString(e,o);if(null!=s)return s}return this.getFallbackTemplate().instantiateToString(e,t)},t.prototype.instantiateToElement=function(e,t){void 0===t&&(t={});for(var o=(new n.DefaultInstantiateTemplateOptions).merge(t),i=l.reject(this.templates,function(e){return null!=e.role}),r=0;r<i.length;r++){var s=i[r].instantiateToElement(e,o);if(null!=s)return s}return this.getFallbackTemplate().instantiateToElement(e,o)},t.prototype.getFields=function(){return l.reduce(this.templates,function(e,t){return e.concat(t.getFields())},[])},t.prototype.getType=function(){return"TemplateList"},t.prototype.getFallbackTemplate=function(){return new r.DefaultResultTemplate},t}(n.Template);t.TemplateList=u},181:function(e,t,o){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(6),r=o(7),s=o(393),l=o(394),u=o(2),a=o(10),p=o(12),d=o(4),m=o(1),c=o(19),h=o(25),f=o(0),v=o(3);o(395);var y=o(74),C=function(e){function t(o,i,n){var s=e.call(this,o,t.ID,n)||this;return s.element=o,s.options=i,s.groupByIndex=[],s.rowId="",s.columnId="",s.selectedRowValue=void 0,s.selectedColumnValue=void 0,s.numberOfRows=0,s.numberOfColumns=0,s.options=r.ComponentOptions.initComponentOptions(o,t,i),s.options.previewTemplate||(s.options.previewTemplate=new l.DefaultMatrixResultPreviewTemplate(s.options.computedField,s.options.computedFieldFormat)),s.options.previewSortField||(s.options.previewSortField=s.options.computedField),s.options.columnFieldValues.length!=s.options.columnLabels.length&&(s.options.columnLabels=s.options.columnFieldValues),s.buildMatrix(),null==s.options.rowField?s.logger.error("'rowField' option is required in the Matrix component"):null==s.options.columnField?s.logger.error("'columnField' option is required in the Matrix component"):null==s.options.computedField?s.logger.error("'computedField' option is required in the Matrix component"):(s.bindEvents(),s.initQueryState()),s}return i(t,e),t.prototype.selectCell=function(e,t){var o,i;0!==e&&e!==this.numberOfRows-1&&(o=this.getRowValue(e)),0!==t&&t!==this.numberOfColumns-1&&(i=this.getColumnValue(t)),o&&this.isRowFacetPresent()?this.queryStateModel.set(this.rowId,[o]):(this.selectedRowValue=o,this.queryStateModel.set(this.rowId,[])),i&&this.isColumnFacetPresent()?this.queryStateModel.set(this.columnId,[i]):(this.selectedColumnValue=i,this.queryStateModel.set(this.columnId,[]))},t.prototype.getSelectedColumnValue=function(){return this.selectedColumnValue},t.prototype.getSelectedRowValue=function(){return this.selectedRowValue},t.prototype.getCellElement=function(e,t){return this.data[e][t].getHTML()},t.prototype.getCellValue=function(e,t){var o=this.getCellElement(e,t);return u.$$(o).text()},t.prototype.drawMatrix=function(){var e=this,t=u.$$("div",{className:"coveo-matrix-row matrix-header-row"});this.drawRow(t.el,0);for(var o=this.options.enableColumnTotals?this.numberOfRows-1:this.numberOfRows,i=1;i<o;i++){var n=u.$$("div",{className:"coveo-matrix-row"}).el;this.drawRow(n,i)}if(this.options.enableColumnTotals){var r=u.$$("div",{className:"coveo-matrix-row matrix-total-row"}).el;this.drawRow(r,this.numberOfRows-1)}if(""!==this.options.cellFontSize){var s=u.$$(this.element).findAll(".coveo-matrix-cell");f.each(s,function(t){t.style.fontSize=e.options.cellFontSize})}},t.prototype.bindEvents=function(){var e=this;this.bind.onRootElement(a.QueryEvents.buildingQuery,function(t){return e.handleBuildingQuery(t)}),this.bind.onRootElement(a.QueryEvents.doneBuildingQuery,function(t){return e.handleDoneBuildingQuery(t)}),this.bind.onRootElement(a.QueryEvents.deferredQuerySuccess,function(t){return e.handleDeferredQuerySuccess(t)})},t.prototype.initQueryState=function(){this.rowId=p.QueryStateModel.getFacetId(this.options.rowField),this.columnId=p.QueryStateModel.getFacetId(this.options.columnField),this.queryStateModel.registerNewAttribute(this.rowId,[]),this.queryStateModel.registerNewAttribute(this.columnId,[])},t.prototype.buildMatrix=function(){this.buildTitle(),this.buildBody(),this.data=new Array,this.addHeaderRow()},t.prototype.buildTitle=function(){var e=this.options.title?this.options.title:"",t=u.$$("div",{className:"coveo-matrix-title"},e).el;this.element.appendChild(t)},t.prototype.buildBody=function(){var e=u.$$("div",{className:"coveo-matrix"}).el;this.element.appendChild(e)},t.prototype.handleBuildingQuery=function(e){this.areFacetsPresent()||(this.selectedRowValue&&!this.isRowFacetPresent()&&e.queryBuilder.advancedExpression.addFieldExpression(this.options.rowField,"=",[this.selectedRowValue]),this.selectedColumnValue&&!this.isColumnFacetPresent()&&e.queryBuilder.advancedExpression.addFieldExpression(this.options.columnField,"=",[this.selectedColumnValue]))},t.prototype.handleDoneBuildingQuery=function(e){this.groupByIndex=[],this.addMainGroubByRequest(e.queryBuilder),this.addColumnsGroupByRequests(e.queryBuilder)},t.prototype.handleDeferredQuerySuccess=function(e){this.reset(),this.parseResults(e.results),this.addTotals(),this.drawMatrix(),this.formatCells(),this.selectedRowValue=void 0,this.selectedColumnValue=void 0},t.prototype.addMainGroubByRequest=function(e){var t={field:this.options.rowField,sortCriteria:this.options.sortCriteria,computedFields:this.getComputedFields(),maximumNumberOfValues:this.options.maximumNumberOfRows};this.groupByIndex.push(e.groupByRequests.length),e.groupByRequests.push(t)},t.prototype.addColumnsGroupByRequests=function(e){for(var t=0;t<this.options.columnFieldValues.length;t++){var o={field:this.options.rowField,sortCriteria:this.options.sortCriteria,computedFields:this.getComputedFields(),queryOverride:"("+this.buildExpression(e)+")("+this.options.columnField+"='"+this.options.columnFieldValues[t]+"')",maximumNumberOfValues:this.options.maximumNumberOfValuesInGroupBy};this.groupByIndex.push(e.groupByRequests.length),e.groupByRequests.push(o)}},t.prototype.buildExpression=function(e){var t=e.expression.build(),o=e.advancedExpression.build(),i=e.constantExpression.build(),n="";return t&&(n+=" "+t),o&&(n+=" "+o),i&&(n+=" "+i),n},t.prototype.getComputedFields=function(){return[{field:this.options.computedField,operation:this.options.computedFieldOperation}]},t.prototype.getCellResult=function(e,t,o){for(var i=this.getRowValue(t),n=this.getColumnValue(o),r=0,s=0;s<e.values.length;s++)if(e.values[s].value===i){r=e.values[s].computedFieldResults[0];break}return this.isAColumnSelected()&&!this.isColumnSelected(n)&&(r=0),r},t.prototype.addTotals=function(){this.options.enableRowTotals&&this.addRowTotals(),this.options.enableColumnTotals&&this.addColumnTotals()},t.prototype.addRowTotals=function(){var e=this;this.addColumn(),this.setValue("Total",0,this.numberOfColumns-1);for(var t=1;t<this.numberOfRows;t++){var o=this.computeRowTotal(t);this.setValue(o,t,this.numberOfColumns-1)}"computedfielddescending"==this.options.sortCriteria.toLowerCase()&&this.data.sort(function(t,o){return o[e.numberOfColumns-1].getValue()-t[e.numberOfColumns-1].getValue()}),"computedfieldascending"==this.options.sortCriteria.toLowerCase()&&this.data.sort(function(t,o){return t[e.numberOfColumns-1].getValue()-o[e.numberOfColumns-1].getValue()})},t.prototype.addColumnTotals=function(){this.addRow(),this.setValue("Total",this.numberOfRows-1,0);for(var e=1;e<this.numberOfColumns;e++){var t=this.computeColumnTotal(e);this.setValue(t,this.numberOfRows-1,e)}},t.prototype.computeRowTotal=function(e){for(var t=0,o=1;o<this.numberOfColumns-1;o++)t+=parseInt(this.getCellValue(e,o));return t},t.prototype.computeColumnTotal=function(e){for(var t=0,o=1;o<this.numberOfRows-1;o++)t+=parseInt(this.getCellValue(o,e));return t},t.prototype.formatCells=function(){for(var e=1;e<this.numberOfRows;e++)for(var t=1;t<this.numberOfColumns;t++){var o=this.getCellValue(e,t);o=h.format(parseInt(o),this.options.computedFieldFormat),this.setValue(o,e,t)}},t.prototype.addHeaderRow=function(){this.addRow(),this.addColumn(),this.setValue(this.options.columnHeader,0,0);for(var e=0;e<this.options.columnLabels.length;e++)this.addColumn(),this.setValue(this.options.columnLabels[e],0,e+1)},t.prototype.addRow=function(){this.data.push(new Array);for(var e=0;e<this.numberOfColumns;e++)this.addCellToRow(this.numberOfRows,e);this.numberOfRows++},t.prototype.addColumn=function(){for(var e=0;e<this.numberOfRows;e++)this.addCellToRow(e,this.numberOfColumns);this.numberOfColumns++},t.prototype.addCellToRow=function(e,t){var o=u.$$("div",{className:"coveo-matrix-cell"});0==t&&o.addClass("matrix-first-column"),this.data[e].push(new s.Cell(0,o.el))},t.prototype.setValue=function(e,t,o){var i=this.getCellElement(t,o);d.Utils.isNullOrUndefined(e)||u.$$(i).text(e.toString()),this.isCellSelected(this.getRowValue(t),this.getColumnValue(o))&&u.$$(i).addClass("coveo-matrix-selected"),this.isAColumnSelected()&&!this.isColumnSelected(this.getColumnValue(o))&&0!=o&&0!=t&&u.$$(i).addClass("coveo-matrix-unimportant"),this.data[t][o].setValue(e)},t.prototype.handleClick=function(e,t){this.selectCell(e,t),this.queryController.executeQuery()},t.prototype.getRowValue=function(e){return this.data[e][0].getValue()},t.prototype.getColumnValue=function(e){return this.options.columnFieldValues[e-1]},t.prototype.isAColumnSelected=function(){return 0!==(this.queryStateModel.get(this.columnId)||[]).length||void 0!=this.selectedColumnValue},t.prototype.isColumnSelected=function(e){if(this.isAColumnSelected()&&e)for(var t=this.queryStateModel.attributes[this.columnId]||[],o=0;o<t.length;o++)if(t[o].toLowerCase()===e.toLowerCase())return!0;return this.selectedColumnValue==e},t.prototype.isARowSelected=function(){return 0!==(this.queryStateModel.get(this.rowId)||[]).length||void 0!==this.selectedRowValue},t.prototype.isRowSelected=function(e){if(this.isARowSelected()&&e)for(var t=this.queryStateModel.get(this.rowId)||[],o=0;o<t.length;o++)if(t[o].toLowerCase()===e.toLowerCase())return!0;return this.selectedRowValue==e},t.prototype.isCellSelected=function(e,t){return this.isAColumnSelected()&&this.isARowSelected()?this.isRowSelected(e)&&this.isColumnSelected(t):!!this.isAColumnSelected()&&this.isColumnSelected(t)},t.prototype.areFacetsPresent=function(){return this.isRowFacetPresent()&&this.isColumnFacetPresent()},t.prototype.isRowFacetPresent=function(){var e=this.componentStateModel.get(this.rowId);return e&&!e[0].disabled},t.prototype.isColumnFacetPresent=function(){var e=this.componentStateModel.get(this.columnId);return e&&!e[0].disabled},t.prototype.reset=function(){u.$$(this.element).empty(),this.numberOfRows=0,this.numberOfColumns=0,this.data=new Array,this.buildMatrix()},t.prototype.parseResults=function(e){if(e){var t=e.groupByResults[this.groupByIndex[0]];if(t)for(var o=0;o<t.values.length;o++){var i=t.values[o].value;this.addRow(),this.setValue(i,o+1,0)}for(var o=1;o<this.numberOfRows;o++)for(var n=1;n<this.numberOfColumns;n++){var r=e.groupByResults[this.groupByIndex[n]],s=this.getCellResult(r,o,n);this.setValue(s,o,n)}}},t.prototype.drawRow=function(e,t){for(var o=this,i=u.$$(this.element).find(".coveo-matrix"),n=this,r=0;r<this.numberOfColumns;r++)!function(i){var r=n.data[t][i].getHTML();u.$$(r).on("click",function(){!function(e){o.handleClick(t,e)}(i)}),n.options.enableHoverPreview&&function(e){u.$$(r).on("mouseover",function(){return o.handleHoverIn(t,e)}),u.$$(r).on("mouseout",function(){return o.handleHoverOut(t,e)})}(i),e.appendChild(r)}(r);i.appendChild(e)},t.prototype.handleHoverIn=function(e,t){var o=this;this.isHoverWorkingOnRow(e)&&this.isHoverWorkingOnColumn(t)&&(this.previewTimeout=setTimeout(function(){o.displayResultsPreview(e,t)},this.options.previewDelay))},t.prototype.handleHoverOut=function(e,t){clearTimeout(this.previewTimeout),this.data[e][t].removePreview()},t.prototype.displayResultsPreview=function(e,t){var o=this,i=this.createPreviewQuery(e,t);this.data[e][t].addPreview(this.options.previewMinWidth,this.options.previewMaxWidth),this.queryController.getEndpoint().search(i).then(function(i){if(o.isDataAvailable(e,t)){var n=o.data[e][t],r=f.map(i.results,function(e){return o.instantiateTemplate(e)}),s="";f.each(r,function(e){e.then(function(e){s+=e.outerHTML})}),Promise.all(r).then(function(){n.updatePreview(s)})}})},t.prototype.instantiateTemplate=function(e){var t=this;return this.options.previewTemplate.instantiateToElement(e,{checkCondition:!1,responsiveComponents:this.searchInterface.responsiveComponents}).then(function(o){var i={options:t.options,bindings:t.getBindings(),result:e};return m.Initialization.automaticallyCreateComponentsInside(o,i).initResult.then(function(){return o})})},t.prototype.createPreviewQuery=function(e,t){var o="("+c.QueryUtils.buildFieldExpression(this.options.rowField,"=",[this.getRowValue(e)])+")",i="("+c.QueryUtils.buildFieldExpression(this.options.columnField,"=",[this.getColumnValue(t)])+")",n=this.queryController.getLastQuery();n.aq=o,n.aq+=i,n.sortCriteria=this.options.previewSortCriteria,n.sortField=this.options.previewSortField;var r=this.options.computedField.slice(1);return!f.find(n.fieldsToInclude,function(e){return e==r})&&n.fieldsToInclude&&n.fieldsToInclude.push(r),n},t.prototype.isHoverWorkingOnRow=function(e){return this.options.enableColumnTotals?0!==e&&e!==this.numberOfRows-1:0!==e},t.prototype.isHoverWorkingOnColumn=function(e){return this.options.enableRowTotals?0!==e&&e!==this.numberOfColumns-1:0!==e},t.prototype.isDataAvailable=function(e,t){return void 0!==this.data[e]&&void 0!==this.data[e][t]},t.ID="Matrix",t.doExport=function(){v.exportGlobally({Matrix:t})},t.options={title:r.ComponentOptions.buildStringOption(),rowField:r.ComponentOptions.buildFieldOption({required:!0}),columnField:r.ComponentOptions.buildFieldOption({required:!0}),sortCriteria:r.ComponentOptions.buildStringOption({defaultValue:"ComputedFieldDescending"}),maximumNumberOfRows:r.ComponentOptions.buildNumberOption({defaultValue:10,min:0}),enableRowTotals:r.ComponentOptions.buildBooleanOption({defaultValue:!0}),columnFieldValues:r.ComponentOptions.buildListOption({defaultValue:[]}),columnLabels:r.ComponentOptions.buildListOption({defaultValue:[]}),columnHeader:r.ComponentOptions.buildStringOption(),maximumNumberOfValuesInGroupBy:r.ComponentOptions.buildNumberOption({defaultValue:100,min:0}),enableColumnTotals:r.ComponentOptions.buildBooleanOption({defaultValue:!0}),computedField:r.ComponentOptions.buildFieldOption({required:!0}),computedFieldOperation:r.ComponentOptions.buildStringOption({defaultValue:"sum"}),computedFieldFormat:r.ComponentOptions.buildStringOption({defaultValue:"c0"}),cellFontSize:r.ComponentOptions.buildStringOption({defaultValue:""}),enableHoverPreview:r.ComponentOptions.buildBooleanOption({defaultValue:!0}),previewSortCriteria:r.ComponentOptions.buildStringOption({defaultValue:"FieldDescending"}),previewSortField:r.ComponentOptions.buildFieldOption(),previewMaxWidth:r.ComponentOptions.buildStringOption({defaultValue:"500px"}),previewMinWidth:r.ComponentOptions.buildStringOption({defaultValue:"0"}),previewDelay:r.ComponentOptions.buildNumberOption({defaultValue:500}),previewTemplate:y.TemplateComponentOptions.buildTemplateOption()},t}(n.Component);t.Matrix=C,m.Initialization.registerAutoCreateComponent(C)},393:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(2),n=o(0),r=function(){function e(e,t){void 0===e&&(e=0),this.previewActive=!1,this.element=t,this.value=e}return e.prototype.getValue=function(){return this.value},e.prototype.getHTML=function(){return this.element},e.prototype.setValue=function(e){this.value=e},e.prototype.setHTML=function(e){this.element=e},e.prototype.addPreview=function(e,t){this.previewActive=!0;var o=i.$$("div",{className:"matrix-results-preview-container"});o.el.style.minWidth=e,o.el.style.maxWidth=t,o.on("click",function(e){e.stopPropagation()}),this.element.appendChild(o.el);var r=i.$$(this.element).findAll(".matrix-results-preview-container");n.each(r,function(e){i.$$(e).hide()})},e.prototype.removePreview=function(){this.previewActive=!1;var e=i.$$(this.element).find(".matrix-results-preview-container");e&&i.$$(e).detach()},e.prototype.updatePreview=function(e){if(this.previewActive){var t=i.$$(this.element).find(".matrix-results-preview-container");t.innerHTML+=e,i.$$(t).show()}},e}();t.Cell=r},394:function(e,t,o){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=o(22),r=o(2),s=o(25),l=function(e){function t(t,o){var i=e.call(this)||this;return i.computedField=t,i.format=o,i}return i(t,e),t.prototype.instantiateToString=function(e,t){return"<div class='coveo-result-frame'><div class='coveo-result-row'><div class='coveo-result-cell' style='width: 40px; padding-right:5px;vertical-align: middle'><a class='CoveoIcon' data-small='true'></a></div><div class='coveo-result-cell' style='font-size:13px;vertical-align: middle'><a class='CoveoResultLink'></a></div><div class='coveo-result-cell' style='width:80px; text-align:right; font-size:13px; padding-right: 5px;vertical-align: middle'>"+s.format(parseInt(e.raw[this.computedField.slice(1)]),this.format)+"</div></div></div>"},t.prototype.instantiateToElement=function(e,t){var o=this;return new Promise(function(t,i){return r.$$("div",void 0,o.instantiateToString(e)).el})},t}(n.Template);t.DefaultMatrixResultPreviewTemplate=l},395:function(e,t){},74:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(58),n=o(145),r=o(46),s=o(78),l=o(7),u=o(5),a=o(4),p=o(0),d=function(){function e(){}return e.buildTemplateOption=function(t){return l.ComponentOptions.buildOption(l.ComponentOptionsType.TEMPLATE,e.loadTemplateOption,t)},e.loadTemplateOption=function(t,o,i,n){void 0===n&&(n=document);var r,s=i.selectorAttr||l.ComponentOptions.attrNameFromName(o,i)+"-selector",u=t.getAttribute(s)||l.ComponentOptions.getAttributeFromAlias(t,i);if(null!=u){var a=n.querySelector(u);null!=a&&(r=e.createResultTemplateFromElement(a))}if(null==r){var p=i.idAttr||l.ComponentOptions.attrNameFromName(o,i)+"-id",d=t.getAttribute(p)||l.ComponentOptions.getAttributeFromAlias(t,i);null!=d&&(r=e.loadResultTemplateFromId(d))}if(null==r){var m=i.childSelector;null==m&&(m="."+o.replace(/([A-Z])/g,"-$1").toLowerCase()),r=e.loadChildrenResultTemplateFromSelector(t,m)}return r},e.createResultTemplateFromElement=function(e){u.Assert.exists(e);var t=e.getAttribute("type"),o="You must specify the type of template. Valid values are: "+r.UnderscoreTemplate.mimeTypes.toString()+" "+s.HtmlTemplate.mimeTypes.toString();return u.Assert.check(a.Utils.isNonEmptyString(t),o),-1!=p.indexOf(r.UnderscoreTemplate.mimeTypes,t.toLowerCase())?r.UnderscoreTemplate.create(e):-1!=p.indexOf(s.HtmlTemplate.mimeTypes,t.toLowerCase())?new s.HtmlTemplate(e):void u.Assert.fail("Cannot guess template type from attribute: "+t+". Valid values are "+o)},e.loadResultTemplateFromId=function(e){return a.Utils.isNonEmptyString(e)?i.TemplateCache.getTemplate(e):null},e.loadChildrenResultTemplateFromSelector=function(t,o){var i=l.ComponentOptions.loadChildrenHtmlElementFromSelector(t,o);return i.length>0?new n.TemplateList(p.compact(i.map(function(t){return e.createResultTemplateFromElement(t)}))):null},e}();t.TemplateComponentOptions=d}});