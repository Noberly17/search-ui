{"version":3,"sources":["./src/ui/Distance/DistanceResources.ts","./src/events/DistanceEvents.ts","./src/ui/Distance/NavigatorPositionProvider.ts","./src/ui/Distance/GoogleApiPositionProvider.ts","./src/ui/Distance/StaticPositionProvider.ts"],"names":[],"mappings":"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","file":"DistanceResources.js","sourcesContent":["import { $$ } from '../../utils/Dom';\nimport {\n  DistanceEvents,\n  IResolvingPositionEventArgs,\n  IPosition,\n  IPositionProvider,\n  IPositionResolvedEventArgs\n} from '../../events/DistanceEvents';\n\nimport { analyticsActionCauseList } from '../Analytics/AnalyticsActionListMeta';\nimport { Component } from '../Base/Component';\nimport { IFieldOption, ComponentOptions } from '../Base/ComponentOptions';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { InitializationEvents, QueryEvents } from '../../EventsModules';\nimport { IQueryFunction } from '../../rest/QueryFunction';\nimport { IBuildingQueryEventArgs } from '../../events/QueryEvents';\nimport { Dom } from '../../UtilsModules';\nimport { Initialization } from '../Base/Initialization';\nimport { get } from '../Base/RegisteredNamedMethods';\nimport { exportGlobally } from '../../GlobalExports';\nimport { NavigatorPositionProvider } from './NavigatorPositionProvider';\nimport { GoogleApiPositionProvider } from './GoogleApiPositionProvider';\nimport { StaticPositionProvider } from './StaticPositionProvider';\n\nexport interface IDistanceOptions {\n  distanceField: IFieldOption;\n  latitudeField: IFieldOption;\n  longitudeField: IFieldOption;\n  unitConversionFactor: number;\n  disabledDistanceCssClass: string;\n  latitudeValue: number;\n  longitudeValue: number;\n  googleApiKey: string;\n  useNavigator: boolean;\n  triggerNewQueryOnNewPosition: boolean;\n  cancelQueryUntilPositionResolved: boolean;\n}\n\n/**\n * The `DistanceResources` component defines a field that computes the distance according to the user's position.\n *\n * Components that uses the current distance should be disabled until a distance is provided by this component.\n *\n * See also [`DistanceEvents`]{@link DistanceEvents} for events triggered by this component.\n */\nexport class DistanceResources extends Component {\n  public static ID = 'DistanceResources';\n  static doExport = () => {\n    exportGlobally({\n      DistanceResources: DistanceResources\n    });\n  };\n  private latitude: number;\n  private longitude: number;\n  private lastPositionRequest: Promise<IPosition | void>;\n  private isPositionSet = false;\n\n  /**\n   * The possible options for a DistanceResources.\n   * @componentOptions\n   */\n  public static options: IDistanceOptions = {\n    /**\n     * Specifies the field that will contain the distance value.\n     *\n     * Specifying a value for this option is required for the `DistanceResources` component to work.\n     */\n    distanceField: ComponentOptions.buildFieldOption({\n      required: true\n    }),\n    /**\n     * Specifies the field that contains the latitude value.\n     *\n     * Specifying a value for this option is required for the `DistanceResources` component to work.\n     */\n    latitudeField: ComponentOptions.buildFieldOption({\n      required: true\n    }),\n    /**\n     * Specifies the field that contains the longitude value.\n     *\n     * Specifying a value for this option is required for the `DistanceResources` component to work.\n     */\n    longitudeField: ComponentOptions.buildFieldOption({\n      required: true\n    }),\n    /**\n     * The conversion factor to use for the distance according to the base unit, in meters.\n     *\n     * If you want to have Kilometers, you should set 1000 as the value.\n     * If you want to have your distance in miles, you should set 1610 as the value, since a mile is approximately 1610 meters.\n     *\n     * The default value is `1000`.\n     */\n    unitConversionFactor: ComponentOptions.buildNumberOption({\n      defaultValue: 1000,\n      validator: value => {\n        return !!value && value > 0;\n      }\n    }),\n    /**\n     * The CSS class for components that needs to be reenabled when the distance is provided.\n     *\n     * The default value is `coveo-distance-disabled`.\n     */\n    disabledDistanceCssClass: ComponentOptions.buildStringOption({\n      defaultValue: 'coveo-distance-disabled'\n    }),\n    /**\n     * The latitude to use if no other position was provided.\n     *\n     * You must also set `longitudeValue` if you specify this value.\n     */\n    latitudeValue: ComponentOptions.buildNumberOption({\n      float: true\n    }),\n    /**\n     * The longitude to use if no other position was provided.\n     *\n     * You must also set `latitude` if you specify this value.\n     */\n    longitudeValue: ComponentOptions.buildNumberOption({\n      float: true\n    }),\n    /**\n     * The API key to use to request the Google API geolocation service.\n     *\n     * If not defined, will not try to request the service.\n     */\n    googleApiKey: ComponentOptions.buildStringOption(),\n    /**\n     * Whether to request the browser's geolocation service.\n     *\n     * If not defined, will not try to request the service.\n     *\n     * Note that most recent browsers requires your site to be in HTTPS to use its geolocation service.\n     */\n    useNavigator: ComponentOptions.buildBooleanOption(),\n    /**\n     * Whether to execute a new query when a new position has been provided.\n     *\n     * Default value is `true`.\n     */\n    triggerNewQueryOnNewPosition: ComponentOptions.buildBooleanOption({\n      defaultValue: false\n    }),\n    /**\n     * Whether to cancel all the queries until the position is resolved.\n     *\n     * Default value is `true`\n     */\n    cancelQueryUntilPositionResolved: ComponentOptions.buildBooleanOption({\n      defaultValue: true\n    })\n  };\n\n  /**\n   * Creates a new `DistanceResources` component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `DistanceResources` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  constructor(public element: HTMLElement, public options: IDistanceOptions, public bindings: IComponentBindings) {\n    super(element, DistanceResources.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, DistanceResources, options);\n    this.registerDistanceQuery();\n    this.bind.onRootElement(InitializationEvents.afterComponentsInitialization, () => this.onAfterComponentsInitialization());\n  }\n\n  /**\n   * Override the current position with the provided values.\n   *\n   * Does not triggers a query automatically.\n   * @param latitude The latitude to set.\n   * @param longitude The longitude to set.\n   */\n  public setPosition(latitude: number, longitude: number): void {\n    this.latitude = latitude;\n    this.longitude = longitude;\n\n    const args: IPositionResolvedEventArgs = {\n      position: {\n        latitude: latitude,\n        longitude: longitude\n      }\n    };\n\n    this.bind.trigger(this.element, DistanceEvents.onPositionResolved, args);\n\n    const shouldTriggerQuery = this.shouldTriggerQueryWhenPositionSet();\n    this.isPositionSet = true;\n    if (shouldTriggerQuery) {\n      this.usageAnalytics.logSearchEvent(analyticsActionCauseList.positionSet, {});\n      this.queryController.executeQuery();\n    }\n  }\n\n  private shouldTriggerQueryWhenPositionSet() {\n    // If query has been cancelled, we need to trigger the first one.\n    const triggerFirstQueryWithPosition = this.options.cancelQueryUntilPositionResolved && !this.isPositionSet;\n    return this.options.triggerNewQueryOnNewPosition || triggerFirstQueryWithPosition;\n  }\n\n  /**\n   * Returns a promise of the last position resolved using the registered position providers.\n   *\n   * @returns {Promise<IPosition>} Promise for the last resolved position value.\n   */\n  public getLastPositionRequest(): Promise<IPosition> {\n    return this.lastPositionRequest || Promise.reject('No position request was executed yet.');\n  }\n\n  private onAfterComponentsInitialization(): void {\n    const args: IResolvingPositionEventArgs = {\n      providers: this.getProvidersFromOptions()\n    };\n\n    this.bind.trigger(this.element, DistanceEvents.onResolvingPosition, args);\n\n    this.lastPositionRequest = this.tryGetPositionFromProviders(args.providers)\n      .then(position => {\n        if (position) {\n          this.setPosition(position.latitude, position.longitude);\n        } else {\n          this.triggerDistanceNotSet();\n        }\n        return position;\n      })\n      .catch(error => {\n        this.logger.error('An error occured when trying to resolve the current position.', error);\n        this.triggerDistanceNotSet();\n      });\n  }\n\n  private getProvidersFromOptions(): IPositionProvider[] {\n    const providers: IPositionProvider[] = [];\n\n    if (this.options.useNavigator) {\n      providers.push(new NavigatorPositionProvider());\n    }\n\n    if (this.options.googleApiKey) {\n      providers.push(new GoogleApiPositionProvider(this.options.googleApiKey));\n    }\n\n    if (this.options.longitudeValue && this.options.latitudeValue) {\n      providers.push(new StaticPositionProvider(this.options.latitudeValue, this.options.longitudeValue));\n    }\n\n    return providers;\n  }\n\n  private tryGetPositionFromProviders(providers: IPositionProvider[]): Promise<IPosition> {\n    return new Promise<IPosition>((resolve, reject) => {\n      const tryNextProvider = () => {\n        if (providers.length > 0) {\n          const provider = providers.shift();\n          provider\n            .getPosition()\n            .then(position => {\n              if (!!position.latitude && !!position.longitude) {\n                resolve(position);\n              } else {\n                tryNextProvider();\n              }\n            })\n            .catch(error => {\n              this.logger.warn('An error occured when tring to resolve the position within a position provider.', error);\n              tryNextProvider();\n            });\n        } else {\n          resolve();\n        }\n      };\n      tryNextProvider();\n    });\n  }\n\n  private triggerDistanceNotSet(): void {\n    this.isPositionSet = false;\n    this.logger.warn(\n      `None of the given position providers could resolve the current position. The distance field will not be calculated and the distance components will be disabled until the next call to 'setPosition'.`\n    );\n    this.bind.trigger(this.element, DistanceEvents.onPositionNotResolved, {});\n  }\n\n  private registerDistanceQuery(): void {\n    this.bind.onRootElement(QueryEvents.buildingQuery, (args: IBuildingQueryEventArgs) => {\n      if (this.isPositionSet) {\n        if (args && args.queryBuilder) {\n          const geoQueryFunction: IQueryFunction = {\n            function: this.getConvertedUnitsFunction(\n              `dist(${this.options.latitudeField}, ${this.options.longitudeField}, ${this.latitude}, ${this.longitude})`\n            ),\n            fieldName: `${this.options.distanceField}`\n          };\n          args.queryBuilder.queryFunctions.push(geoQueryFunction);\n          this.enableDistanceComponents();\n        }\n      } else if (this.options.cancelQueryUntilPositionResolved) {\n        this.logger.info('Query cancelled, waiting for position');\n        args.cancel = true;\n      }\n    });\n  }\n\n  private enableDistanceComponents(): void {\n    $$(this.root)\n      .findAll(`.${this.options.disabledDistanceCssClass}`)\n      .forEach(element => {\n        try {\n          element.classList.remove(this.options.disabledDistanceCssClass);\n          const coveoComponent = get(element);\n          if (coveoComponent) {\n            coveoComponent.enable();\n          }\n        } catch (exception) {\n          this.logger.error('Could not re-enable distance component.', exception, element);\n        }\n      });\n  }\n\n  private getConvertedUnitsFunction(queryFunction: string): string {\n    return `${queryFunction}/${this.options.unitConversionFactor}`;\n  }\n}\n\nInitialization.registerAutoCreateComponent(DistanceResources);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Distance/DistanceResources.ts","export interface IPosition {\n  longitude: number;\n  latitude: number;\n}\n\nexport interface IPositionProvider {\n  getPosition(): Promise<IPosition>;\n}\n\n/**\n * Argument sent to all handlers bound on {@link DistanceEvents.onResolvingPosition}\n */\nexport interface IResolvingPositionEventArgs {\n  /*\n   * List of all the providers that can provide a position. The first one that can resolve the position will be used.\n   */\n  providers: IPositionProvider[];\n}\n\n/**\n * Argument sent to all handlers bound on {@link DistanceEvents.onPositionResolved}\n */\nexport interface IPositionResolvedEventArgs {\n  /*\n   * The position that was resolved.\n   */\n  position: IPosition;\n}\n\n/**\n * This static class contains the different string definitions for all the events related to distance.\n */\nexport class DistanceEvents {\n  /**\n   * Triggered when the [`DistanceResources`]{@link DistanceResources} component sucessfully resolves the position.\n   *\n   * All bound handlers will receive {@link IPositionResolvedEventArgs} as an argument.\n   *\n   * The string value is `onPositionResolved`.\n   * @type {string}\n   */\n  public static onPositionResolved = 'onPositionResolved';\n  /**\n   * Triggered when the [`DistanceResources`]{@link DistanceResources} component tries to resolve the position.\n   *\n   * Use this event to register new position providers.\n   *\n   * All bound handlers will receive {@link IResolvingPositionEventArgs} as an argument.\n   *\n   * The string value is `onResolvingPosition`.\n   * @type {string}\n   */\n  public static onResolvingPosition = 'onResolvingPosition';\n  /**\n   * Triggered when the [`DistanceResources`]{@link DistanceResources} component fails to resolve the position.\n   *\n   * Use this event to show an error to the end user, or hide components that cannot be used.\n   *\n   * The string value is `onPositionNotResolved`.\n   * @type {string}\n   */\n  public static onPositionNotResolved = 'onPositionNotResolved';\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/events/DistanceEvents.ts","import { IPositionProvider, IPosition } from '../../events/DistanceEvents';\n\n/**\n * The `NavigatorPositionProvider` component provides the user's position to a [`DistanceResources`]{@link DistanceResources} component according to the current navigator.\n *\n * Note that most browser requires your site to be in HTTPS to use this API.\n */\nexport class NavigatorPositionProvider implements IPositionProvider {\n  public getPosition(): Promise<IPosition> {\n    return new Promise<IPosition>((resolve, reject) => {\n      navigator.geolocation.getCurrentPosition(\n        position => {\n          resolve({\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude\n          });\n        },\n        error => {\n          reject(error);\n        }\n      );\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Distance/NavigatorPositionProvider.ts","import { EndpointCaller } from '../../rest/EndpointCaller';\nimport { IPosition, IPositionProvider } from '../../events/DistanceEvents';\n\nconst GOOGLE_MAP_BASE_URL = 'https://www.googleapis.com/geolocation/v1/geolocate';\n\ninterface IGeolocationResponse {\n  location: IGeolocationResponseLocation;\n}\n\ninterface IGeolocationResponseLocation {\n  lat: number;\n  lng: number;\n}\n\n/**\n * The `GoogleApiPositionProvider` component provides the user's position to a [`DistanceResources`]{@link DistanceResources} component using Google's geolocation API.\n */\nexport class GoogleApiPositionProvider implements IPositionProvider {\n  constructor(private googleApiKey: string) {}\n\n  public getPosition(): Promise<IPosition> {\n    return new EndpointCaller()\n      .call<IGeolocationResponse>({\n        errorsAsSuccess: false,\n        method: 'GET',\n        queryString: [`key=${this.googleApiKey}`],\n        requestData: {},\n        responseType: 'json',\n        url: GOOGLE_MAP_BASE_URL\n      })\n      .then(responseData => {\n        const location = responseData.data.location;\n        return {\n          longitude: location.lng,\n          latitude: location.lat\n        };\n      });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Distance/GoogleApiPositionProvider.ts","import { IPositionProvider, DistanceEvents, IPosition } from '../../events/DistanceEvents';\n\n/**\n * The `StaticPositionProvider` component provides a static user position to a [`DistanceResources`]{@link DistanceResources} component.\n */\nexport class StaticPositionProvider implements IPositionProvider {\n  constructor(private latitude: number, private longitude: number) {}\n\n  public getPosition(): Promise<IPosition> {\n    return Promise.resolve({\n      longitude: this.longitude,\n      latitude: this.latitude\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Distance/StaticPositionProvider.ts"],"sourceRoot":""}