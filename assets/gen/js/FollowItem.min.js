webpackJsonpCoveo__temporary([24],{20:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.addClassToSVGInContainer=function(e,o){var n=e.querySelector("svg");n.setAttribute("class",""+t.getClass(n)+o)},t.removeClassFromSVGInContainer=function(e,o){var n=e.querySelector("svg");n.setAttribute("class",t.getClass(n).replace(o,""))},t.getClass=function(t){var e=t.getAttribute("class");return e?e+" ":""},t}();e.SVGDom=n},269:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SUBSCRIPTION_TYPE={followQuery:"followQuery",followDocument:"followDocument"}},303:function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=o(8),l=o(9),s=o(7),r=o(59),a=o(269),c=o(2),u=o(10),d=o(3),p=o(12),f=o(18),h=o(1),m=o(6),g=o(23),v=o(4),y=o(15),w=o(20),C=function(t){function e(o,n,i,a){var c=t.call(this,o,e.ID,i)||this;c.element=o,c.options=n,c.bindings=i,c.result=a,c.options=l.ComponentOptions.initComponentOptions(o,e,n),s.Assert.exists(c.result),c.container=d.$$(c.element),c.text=d.$$("span");var u=c.buildIcon(),p=c.buildLoadingIcon();return c.container.append(u),c.container.append(p),c.container.append(c.text.el),c.container.on("click",function(){return c.toggleFollow()}),c.container.setAttribute("tabindex","0"),c.bind.on(c.container,"keyup",g.KeyboardUtils.keypressAction(g.KEYBOARD.ENTER,function(){return c.toggleFollow()})),c.bind.onRootElement(r.SearchAlertsEvents.searchAlertsDeleted,function(t){return c.handleSubscriptionDeleted(t)}),c.bind.onRootElement(r.SearchAlertsEvents.searchAlertsCreated,function(t){return c.handleSubscriptionCreated(t)}),c.container.addClass("coveo-follow-item-loading"),c.updateIsFollowed(),c}return n(e,t),e.prototype.setFollowed=function(t){this.container.removeClass("coveo-follow-item-loading"),this.subscription=t,this.container.addClass("coveo-follow-item-followed"),this.text.text(u.l("SearchAlerts_unFollowing"))},e.prototype.setNotFollowed=function(){this.container.removeClass("coveo-follow-item-loading"),this.subscription=e.buildFollowRequest(this.getId(),this.result.title,this.options),this.container.removeClass("coveo-follow-item-followed"),this.text.text(u.l("SearchAlerts_follow"))},e.prototype.toggleFollow=function(){var t=this;this.container.hasClass("coveo-follow-item-loading")||(this.container.removeClass("coveo-follow-item-followed"),this.container.addClass("coveo-follow-item-loading"),this.subscription.id?(this.logAnalyticsEvent(p.analyticsActionCauseList.searchAlertsUnfollowDocument),this.queryController.getEndpoint().deleteSubscription(this.subscription).then(function(){var e={subscription:t.subscription,dom:t.element};d.$$(t.root).trigger(r.SearchAlertsEvents.searchAlertsDeleted,e)}).catch(function(){t.container.removeClass("coveo-follow-item-loading");var e={dom:t.element};d.$$(t.root).trigger(r.SearchAlertsEvents.searchAlertsFail,e)})):(this.logAnalyticsEvent(p.analyticsActionCauseList.searchAlertsFollowDocument),this.queryController.getEndpoint().follow(this.subscription).then(function(e){var o={subscription:e,dom:t.element};d.$$(t.root).trigger(r.SearchAlertsEvents.searchAlertsCreated,o)}).catch(function(){t.container.removeClass("coveo-follow-item-loading");var e={dom:t.element};d.$$(t.root).trigger(r.SearchAlertsEvents.searchAlertsFail,e)})))},e.prototype.getText=function(){return this.text.text()},e.prototype.updateIsFollowed=function(){var t=this;this.queryController.getEndpoint().listSubscriptions().then(function(e){if(h.isArray(e)){var o=h.find(e,function(e){var o=e.typeConfig;return o&&null!=o.id&&o.id==t.getId()});null!=o?t.setFollowed(o):t.setNotFollowed()}else t.remove()}).catch(function(){t.remove()})},e.prototype.buildIcon=function(){var t=d.$$("span",{className:"coveo-follow-item-icon"},y.SVGIcons.dropdownFollowQuery);return w.SVGDom.addClassToSVGInContainer(t.el,"coveo-follow-item-icon-svg"),t.el},e.prototype.buildLoadingIcon=function(){var t=d.$$("span",{className:"coveo-follow-item-icon-loading"},y.SVGIcons.loading);return w.SVGDom.addClassToSVGInContainer(t.el,"coveo-follow-item-icon-loading-svg"),t.el},e.prototype.handleSubscriptionDeleted=function(t){if(t.subscription&&t.subscription.type==a.SUBSCRIPTION_TYPE.followDocument){t.subscription.typeConfig.id==this.getId()&&this.setNotFollowed()}},e.prototype.handleSubscriptionCreated=function(t){if(t.subscription&&t.subscription.type==a.SUBSCRIPTION_TYPE.followDocument){t.subscription.typeConfig.id==this.getId()&&this.setFollowed(t.subscription)}},e.prototype.remove=function(){this.element.parentElement&&this.element.parentElement.removeChild(this.element)},e.prototype.getId=function(){return m.Utils.getFieldValue(this.result,"sysurihash")||m.Utils.getFieldValue(this.result,"urihash")},e.buildFollowRequest=function(t,e,o){var n={id:t,title:e};return o.modifiedDateField&&(n.modifiedDateField=o.modifiedDateField),o.watchedFields&&(n.watchedFields=o.watchedFields),{type:a.SUBSCRIPTION_TYPE.followDocument,typeConfig:n,name:e}},e.prototype.logAnalyticsEvent=function(t){this.usageAnalytics.logCustomEvent(t,{author:f.QueryUtils.getAuthor(this.result),documentLanguage:f.QueryUtils.getLanguage(this.result),documentSource:f.QueryUtils.getSource(this.result),documentTitle:this.result.title,contentIDValue:f.QueryUtils.getPermanentId(this.result).fieldValue,contentIDKey:f.QueryUtils.getPermanentId(this.result).fieldUsed},this.element)},e}(i.Component);C.ID="FollowItem",C.doExport=function(){v.exportGlobally({FollowItem:C})},C.options={watchedFields:l.ComponentOptions.buildFieldsOption(),modifiedDateField:l.ComponentOptions.buildStringOption()},e.FollowItem=C,c.Initialization.registerAutoCreateComponent(C)}});